(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1220:(e,t,l)=>{Promise.resolve().then(l.bind(l,4728))},4728:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>q});var r=l(5155),n=l(2115);let s="arcgrid_state:v1";function a(){return{params:{role:"dealer",efficiencyReductionByPoint:{0:0,1:1,2:2,3:3,4:4,5:5}},cores:[{family:"order",key:"order_sun",label:"질서의 해",grade:"ancient",enabled:!0,minPts:10,maxPts:20},{family:"order",key:"order_moon",label:"질서의 달",grade:"ancient",enabled:!0,minPts:10,maxPts:20},{family:"order",key:"order_star",label:"질서의 별",grade:"ancient",enabled:!0,minPts:10,maxPts:20},{family:"chaos",key:"chaos_sun",label:"혼돈의 해",grade:"ancient",enabled:!0,minPts:10,maxPts:20},{family:"chaos",key:"chaos_moon",label:"혼돈의 달",grade:"ancient",enabled:!0,minPts:10,maxPts:20},{family:"chaos",key:"chaos_star",label:"혼돈의 별",grade:"ancient",enabled:!0,minPts:10,maxPts:20}],inventory:{order:[],chaos:[]}}}let o=function(){for(var e,t,l=0,r="",n=arguments.length;l<n;l++)(e=arguments[l])&&(t=function e(t){var l,r,n="";if("string"==typeof t||"number"==typeof t)n+=t;else if("object"==typeof t)if(Array.isArray(t)){var s=t.length;for(l=0;l<s;l++)t[l]&&(r=e(t[l]))&&(n&&(n+=" "),n+=r)}else for(r in t)t[r]&&(n&&(n+=" "),n+=r);return n}(e))&&(r&&(r+=" "),r+=t);return r};function i(e){let{title:t,children:l,className:n}=e;return(0,r.jsxs)("section",{className:o("bg-[#2d333b] border border-[#444c56] rounded-lg","flex flex-col",n),children:[t&&(0,r.jsx)("header",{className:"px-4 py-3 border-b border-[#444c56] text-sm font-semibold text-gray-300",children:t}),(0,r.jsx)("div",{className:"p-5 flex-1 flex items-center ",children:l})]})}function d(e){let{value:t,onChange:l,options:s,placeholder:a="선택",className:i,menuClassName:d,disabled:c=!1}=e,[u,m]=(0,n.useState)(!1),[x,p]=(0,n.useState)(-1),f=(0,n.useRef)(null),h=(0,n.useRef)(null),b=(0,n.useRef)(null),v=(0,n.useMemo)(()=>s.findIndex(e=>String(e.value)===String(t)),[s,t]),g=v>=0?s[v]:void 0;function y(e){var t;let r=s[e];r&&(l(r.value),m(!1),null==(t=h.current)||t.focus())}return(0,n.useEffect)(()=>{function e(e){f.current&&(f.current.contains(e.target)||m(!1))}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,n.useEffect)(()=>{u&&(p(v>=0?v:0),requestAnimationFrame(()=>{var e;let t=null==(e=b.current)?void 0:e.querySelector('[data-active="true"]');null==t||t.scrollIntoView({block:"nearest"})}))},[u,v]),(0,r.jsxs)("div",{ref:f,className:o("relative",i),children:[(0,r.jsxs)("button",{ref:h,type:"button",className:o("w-full text-left rounded-md px-3 pr-9 py-1.5 text-sm","bg-[#22272e] border border-[#444c56] text-gray-300","outline-none focus:outline-none ring-0 focus:ring-0","disabled:opacity-60 disabled:cursor-not-allowed"),"aria-haspopup":"listbox","aria-expanded":u,onClick:()=>!c&&m(e=>!e),onKeyDown:function(e){c||(" "===e.key||"Enter"===e.key||"ArrowDown"===e.key||"ArrowUp"===e.key)&&(e.preventDefault(),m(!0))},disabled:c,children:[g?g.label:(0,r.jsx)("span",{className:"text-gray-500",children:a}),(0,r.jsx)("span",{className:"pointer-events-none absolute right-2.5 top-1/2 -translate-y-1/2 text-gray-400",children:(0,r.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,r.jsx)("path",{d:"M5.23 7.21a.75.75 0 0 1 1.06.02L10 10.94l3.71-3.71a.75.75 0 1 1 1.06 1.06l-4.24 4.24a.75.75 0 0 1-1.06 0L5.21 8.29a.75.75 0 0 1 .02-1.08z"})})})]}),u&&(0,r.jsx)("div",{ref:b,role:"listbox",tabIndex:-1,onKeyDown:function(e){if("Escape"===e.key){var t;e.preventDefault(),m(!1),null==(t=h.current)||t.focus();return}if("Enter"===e.key){e.preventDefault(),y(x);return}if("Home"===e.key){e.preventDefault(),p(0);return}if("End"===e.key){e.preventDefault(),p(s.length-1);return}if("ArrowDown"===e.key){e.preventDefault(),p(e=>Math.min(s.length-1,e<0?0:e+1));return}if("ArrowUp"===e.key){e.preventDefault(),p(e=>Math.max(0,e<0?0:e-1));return}},className:o("absolute z-[1000] mt-1 w-full max-h-56 overflow-auto","rounded-md border border-[#444c56] bg-[#1f242b] shadow-xl",d),children:s.map((e,t)=>{let l=t===v,n=t===x;return(0,r.jsx)("div",{role:"option","aria-selected":l,"data-active":n||void 0,className:o("px-3 py-2 text-sm cursor-pointer select-none",n?"bg-[#2b6de0] text-white":"text-gray-200",l&&!n&&"bg-[#2a3139]"),onMouseEnter:()=>p(t),onMouseDown:e=>{e.preventDefault()},onClick:()=>y(t),children:e.label},String(e.value))})})]})}function c(e){let{label:t,children:l}=e;return(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("label",{className:"text-sm",children:t}),l]})}let u={heroic:9,legend:12,relic:15,ancient:17},m={order:"질서",chaos:"혼돈"},x=["안정","견고","불변","침식","왜곡","붕괴"],p={공격력:[0,.029,.067,.105,.134,.172],"추가 피해":[0,.06,.119,.187,.239,.299],"보스 피해":[0,.078,.156,.244,.313,.391]},f={"아군 피해 강화":[0,.052,.104,.156,.208,.26],"아군 공격 강화":[0,.13,.26,.39,.52,.65],낙인력:[0,.167,.334,.501,.668,.835]},h={dealer:["보스 피해","추가 피해","공격력"],supporter:["낙인력","아군 피해 강화","아군 공격 강화"]},b=["보스 피해","추가 피해","공격력","낙인력","아군 피해 강화","아군 공격 강화"],v={"보스 피해":"보","추가 피해":"추",공격력:"공",낙인력:"낙","아군 피해 강화":"아피","아군 공격 강화":"아공"},g=[["order_sun","order_moon","order_star"],["order_moon","order_sun","order_star"],["order_moon","order_star","order_sun"],["order_star","order_sun","order_moon"],["order_star","order_moon","order_sun"],["order_sun","order_star","order_moon"]],y=new Map,j=new Map,N={dealer:new Set(h.dealer),supporter:new Set(h.supporter)};function w(e){let t=String(e).trim();return"안정"===t||"침식"===t||"4"===t?8:"견고"===t||"왜곡"===t||"5"===t?9:10}function k(e,t){return(e.options||[]).find(e=>(null==e?void 0:e.name)===t)}function S(e,t){let l=k(e,"의지력 효율"),r=l&&t.efficiencyReductionByPoint[l.lv]||0,n=w(e.subType),s="number"!=typeof e.baseWill||Number.isNaN(e.baseWill)?null:e.baseWill;return Math.max(1,(null!=s?s:n)-r)}function P(e){let t=k(e,"코어 포인트");return Math.max(0,Math.floor((null==t?void 0:t.lv)||0))}function C(e,t){return{ids:[null,null,null,null],res:function(e,t,l){let r=u[e.grade]||0,n=r,s=[!1,!1,!1,!1];for(let r=0;r<4;r++){let a=t[r];if(!a||a.family!==e.family)break;let o=S(a,l);if(n>=o)n-=o,s[r]=!0;else break}let a=0;return s.forEach((e,l)=>{if(!e)return;let r=t[l];a+=P(r)}),{activated:s,spent:r-n,remain:n,pts:a,flex:{},flexScore:0}}(e,[null,null,null,null],t),t:void 0,overshoot:0,canReachNext:!1,reason:"가능한 조합이 없어 0p로 대체"}}function M(e,t,l,r,n){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:60,a=u[e.grade]||0,o=l.filter(t=>t.family===e.family).map(e=>{let l=S(e,t),r=P(e);return{g:e,need:l,pts:r}}).filter(e=>e.pts>0&&e.need>=1&&e.need<=a);if(0===o.length)return[C(e,t)];let i=Math.max(16,s),d=()=>({list:[],sig:new Set}),c=Array.from({length:5},()=>Array.from({length:a+1},d));c[0][0].list.push({pts:0,need:0,idxs:[]}),c[0][0].sig.add("");let m=(e,t)=>{let l=t.idxs.slice().sort((e,t)=>e-t).join("-");if(!e.sig.has(l)){if(e.list.length>=i){let l=e.list[e.list.length-1];if(t.pts<l.pts||t.pts===l.pts&&t.need>l.need)return}if(e.list.push(t),e.list.sort((e,t)=>t.pts-e.pts||e.need-t.need||t.idxs.length-e.idxs.length),e.list.length>i){let t=e.list.pop().idxs.slice().sort((e,t)=>e-t).join("-");e.sig.delete(t)}e.sig.add(l)}};for(let e=0;e<o.length;e++){let t=o[e].need,l=o[e].pts;if(!(t>a))for(let r=3;r>=0;r--)for(let n=0;n+t<=a;n++){let s=c[r][n];if(!s.list.length)continue;let a=c[r+1][n+t];for(let r of s.list)m(a,{pts:r.pts+l,need:r.need+t,idxs:[...r.idxs,e]})}}let x=[],p=[],f=[],h=new Set,b=(e,t,l)=>{e.push(t),e.sort((e,t)=>{var l,r,n,s,a,o,i,d;let c=null!=(a=null==(l=e.res)?void 0:l.pts)?a:0,u=null!=(o=null==(r=t.res)?void 0:r.pts)?o:0;if(u!==c)return u-c;let m=null!=(i=null==(n=e.res)?void 0:n.remain)?i:0;return(null!=(d=null==(s=t.res)?void 0:s.remain)?d:0)-m}),e.length>l&&e.pop()};for(let e=1;e<=4;e++)for(let t=0;t<=a;t++){let l=c[e][t];if(l.list.length)for(let e of l.list){var v,g,y,j,N,w,k,M,_,L,E,O;let t=e.idxs.slice().sort((e,t)=>o[e].need-o[t].need).map(e=>o[e].g),l=[null!=(N=t[0])?N:null,null!=(w=t[1])?w:null,null!=(k=t[2])?k:null,null!=(M=t[3])?M:null],i={activated:[!!l[0],!!l[1],!!l[2],!!l[3]],spent:e.need,remain:a-e.need,pts:e.pts,flex:{},flexScore:0},d=[null!=(_=null==(v=l[0])?void 0:v.id)?_:null,null!=(L=null==(g=l[1])?void 0:g.id)?L:null,null!=(E=null==(y=l[2])?void 0:y.id)?E:null,null!=(O=null==(j=l[3])?void 0:j.id)?O:null],c=d.filter(Boolean).sort().join(",");if(h.has(c))continue;h.add(c);let u={ids:d,res:i,t:void 0,overshoot:0,canReachNext:!1,reason:null},m=i.pts;b(m>=r&&m<=n?x:m<=n?p:f,u,s)}}return x.length?x:p.length?p:f.length?f:[C(e,t)]}function _(e,t,l,r){var n,s,a;let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:80,i=arguments.length>5?arguments[5]:void 0,d=arguments.length>6?arguments[6]:void 0;if(0===e.length)return{answer:{},used:new Set};let c=new Map;for(let n of e){let e=r[n.key]||{minPts:0,maxPts:999},s=M(n,t,l,e.minPts,e.maxPts,o);c.set(n.key,s)}let u=new Map;for(let t of e){let e=(c.get(t.key)||[]).reduce((e,t)=>{var l,r;return Math.max(e,null!=(r=null==(l=t.res)?void 0:l.pts)?r:0)},0);u.set(t.key,e)}let m=e.slice().sort((e,t)=>u.get(t.key)-u.get(e.key)),x=e=>i&&d?O(e.ids||[],d,i):0,p={},f=!1,h=-1,b=-1,v=-1;if(!function e(t,l,r,n,s,a){if(t===m.length){(n>h||n===h&&s>b||n===h&&s===b&&a>v)&&(h=n,b=s,v=a,p={...r},f=!0);return}let o=n;for(let e=t;e<m.length;e++)o+=u.get(m[e].key)||0;if(o<h)return;let i=m[t];for(let o of c.get(i.key)||[]){var d,g,y,j,N;let c=(null!=(y=o.ids)?y:[]).filter(Boolean);if(c.some(e=>l.has(e)))continue;let u=new Set(l);for(let e of c)u.add(e);let m={...r,[i.key]:o},p=null!=(j=null==(d=o.res)?void 0:d.pts)?j:0,f=null!=(N=null==(g=o.res)?void 0:g.remain)?N:0;e(t+1,u,m,n+p,s+x(o),a+f)}}(0,new Set,{},0,0,0),f&&Object.keys(p).length===m.length){let e=new Set;for(let t of Object.keys(p))for(let l of null!=(n=p[t].ids)?n:[])l&&e.add(l);return{answer:p,used:e}}let g=f?{...p}:{},y=new Set;for(let e of Object.keys(g))for(let t of null!=(s=g[e].ids)?s:[])t&&y.add(t);for(let e of m){if(g[e.key])continue;let n=r[e.key]||{minPts:0,maxPts:999},s=M(e,t,l.filter(e=>!y.has(e.id)),n.minPts,n.maxPts,o).reduce((e,t)=>{var l,r,n,s,a,o,i,d;if(!e)return t;let c=null!=(a=null==(l=e.res)?void 0:l.pts)?a:0,u=null!=(o=null==(r=t.res)?void 0:r.pts)?o:0;if(u!==c)return u>c?t:e;let m=x(e),p=x(t);if(p!==m)return p>m?t:e;let f=null!=(i=null==(n=e.res)?void 0:n.remain)?i:0;return(null!=(d=null==(s=t.res)?void 0:s.remain)?d:0)>f?t:e},null)||C(e,t);for(let t of(g[e.key]=s,null!=(a=s.ids)?a:[]))t&&y.add(t)}return{answer:g,used:y}}function L(e,t,l,r){var n;j.clear(),y.clear();let s=e.filter(e=>"order"===e.family),a=e.filter(e=>"chaos"===e.family),o=null!=(n=t.role)?n:"dealer",i=new Map;for(let e of l.order||[])i.set(e.id,e);for(let e of l.chaos||[])i.set(e.id,e);let d=_(s,t,l.order||[],r,1e3,o,i),c=_(a,t,l.chaos||[],r,1e3,o,i),u={};for(let e of s)u[e.key]=d.answer[e.key]||C(e,t);for(let e of a)u[e.key]=c.answer[e.key]||C(e,t);let m=new Set;return d.used.forEach(e=>m.add(e)),c.used.forEach(e=>m.add(e)),function(e,t,l){let r=new Map;for(let e of t.order||[])r.set(e.id,e);for(let e of t.chaos||[])r.set(e.id,e);let n=0;for(let t of Object.keys(e.answer)){let s=e.answer[t],a=s.ids||[],o=0;for(let e of a){if(!e)continue;let t=r.get(e);t&&(o+=E(t,l))}s.res.flexScore=o,n+=o}return{plan:e,statTotal:n}}({answer:u,used:Array.from(m)},l,o).plan}function E(e,t){let l=j.get(e.id);if(l)return"dealer"===t?l.d:l.s;let r=0,n=0;for(let t of e.options||[]){if(!t||null==t.lv)continue;let e=function(e){let t=String(e||"").trim(),l=y.get(t);if(l)return l;let r=t;return p[r]||f[r]||v[r]&&(r=v[r]),y.set(t,r),r}(t.name);if("의지력 효율"!==e&&"코어 포인트"!==e){if(N.dealer.has(e)){let l=p[e];l&&(r+=l[Math.max(0,Math.min(l.length-1,Number(t.lv||0)))]||0)}if(N.supporter.has(e)){let l=f[e];l&&(n+=l[Math.max(0,Math.min(l.length-1,Number(t.lv||0)))]||0)}}}return j.set(e.id,{d:r,s:n}),"dealer"===t?r:n}function O(e,t,l){let r=0;for(let n of e){if(!n)continue;let e=t.get(n);e&&(r+=E(e,l))}return r}function R(e,t,l,r,n){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2e3;j.clear(),y.clear();let i=e.filter(e=>e.enabled),d=new Map;for(let e of l.order||[])d.set(e.id,e);for(let e of l.chaos||[])d.set(e.id,e);let c=new Map;for(let e of i){let s=r[e.key]||{minPts:0,maxPts:999},a=M(e,t,l[e.family]||[],s.minPts,s.maxPts,o),i=a.filter(e=>{var t,l;let r=null!=(l=null==(t=e.res)?void 0:t.pts)?l:0;return r>=s.minPts&&r<=s.maxPts}),u=(i.length?i:a).map(e=>{var t,l,r,s;let a=O(e.ids||[],d,n),o={...e,res:{...e.res,flexScore:a}};return{item:o,stat:a,pts:null!=(r=null==(t=o.res)?void 0:t.pts)?r:0,remain:null!=(s=null==(l=o.res)?void 0:l.remain)?s:0}}).sort((e,t)=>t.stat-e.stat||t.pts-e.pts||t.remain-e.remain);c.set(e.key,u)}for(let e of i)if(0===(c.get(e.key)||[]).length)return[];let u=i.slice().sort((e,t)=>{var l,r,n,s;let a=null!=(n=null==(l=(c.get(e.key)||[])[0])?void 0:l.stat)?n:0;return(null!=(s=null==(r=(c.get(t.key)||[])[0])?void 0:r.stat)?s:0)-a}),m=new Map,x=new Map;for(let e of u){let t=c.get(e.key)||[];m.set(e.key,t.length?t[0].stat:0),x.set(e.key,t.reduce((e,t)=>Math.max(e,t.pts),0))}let p=[],f=new Map,h=e=>e.toFixed(6);return!function e(t,l,r,n,o,i){if(t===u.length){if(null!=a&&o!==a)return;let e=[];for(let t of Object.keys(r))for(let l of r[t].ids||[])l&&e.push(l);((e,t,l,r)=>{let n=h(t),a={plan:e,statScore:t,sumPts:l,sumRemain:r},o=f.get(n);if(!o||l>o.sumPts||l===o.sumPts&&r>o.sumRemain){f.set(n,a);let e=p.findIndex(e=>h(e.statScore)===n);if(e>=0?p[e]=a:p.push(a),p.sort((e,t)=>t.statScore-e.statScore||t.sumPts-e.sumPts||t.sumRemain-e.sumRemain),p.length>s){let e=p.pop(),t=h(e.statScore);f.get(t)===e&&f.delete(t)}}})({answer:{...r},used:e},n,o,i);return}let d=n;for(let e=t;e<u.length;e++)d+=m.get(u[e].key)||0;if(d<=(p.length<s?-1/0:p[p.length-1].statScore))return;if(null!=a){if(o>a)return;let e=o;for(let l=t;l<u.length;l++)e+=x.get(u[l].key)||0;if(e<a)return}let b=u[t];for(let s of c.get(b.key)||[]){let a=(s.item.ids||[]).filter(Boolean),d=!1;for(let e of a)if(l.has(e)){d=!0;break}if(d)continue;let c=new Set(l);for(let e of a)c.add(e);e(t+1,c,{...r,[b.key]:s.item},n+s.stat,o+s.pts,i+s.remain)}}(0,new Set,{},0,0,0),p}Object.fromEntries(Object.entries(v).map(e=>{let[t,l]=e;return[l,t]}));let D={보:"보스 피해",보스피해:"보스 피해","보스 피해":"보스 피해",추:"추가 피해",추가피해:"추가 피해","추가 피해":"추가 피해",추피:"추가 피해",공:"공격력",공격:"공격력",공격력:"공격력",낙:"낙인력",낙인:"낙인력",낙인력:"낙인력",아피:"아군 피해 강화",아군피해강화:"아군 피해 강화","아군 피해 강화":"아군 피해 강화",아공:"아군 공격 강화",아군공격강화:"아군 공격 강화","아군 공격 강화":"아군 공격 강화"},T={order:"order",질서:"order",chaos:"chaos",혼돈:"chaos"};function U(e){let{onClose:t,onConfirm:l}=e,[s,a]=(0,n.useState)(""),[o,i]=(0,n.useState)("order"),[d,c]=(0,n.useState)(null),[u,m]=(0,n.useState)([]);return(0,n.useEffect)(()=>{!function(){c(null);let e=s.split(/\r?\n/),t=[];for(let l of e)if(l.trim())try{let e=function(e,t){var l,r,n,s;let a=e.trim().split(/\s+/).filter(Boolean);if(!a.length)return null;let o=0,i=(n=a[0],null!=(s=T[(n||"").trim().toLowerCase()])?s:t);T[null==(r=a[o])||null==(l=r.trim())?void 0:l.toLowerCase()]&&o++;let d=Number(a[o++]),c=Number(a[o++]);if(!(d>=1&&d<=9))throw Error("의지력 need 1~9");if(!(c>=1&&c<=5))throw Error("포인트 1~5");let u=[];for(;o<a.length&&u.length<2;){let e=function(e){if(!e)return null;let t=e.replace(/\s+/g,"").match(/^([가-힣a-zA-Z]+)(\d)$/);if(!t)return null;let l=D[t[1]],r=Number(t[2]);return l&&r>=1&&r<=5?{name:l,lv:r}:null}(a[o]);e&&u.push(e),o++}let m="order"===i?"안정":"침식",x=w(m),p=x-d;return{family:i,subType:m,base:x,effLv:p=Math.max(1,Math.min(5,Number.isFinite(p)?p:1)),need:d,pts:c,opts:u}}(l,o);e&&t.push(e)}catch(e){c('오류: "'.concat(l.trim(),'" → ').concat(e.message));return}m(t)}()},[s,o]),(0,r.jsx)("div",{className:"fixed inset-0 z-[1000] bg-black/40 flex items-center justify-center p-4 sm:p-6 md:p-8 font-sans",onDragOver:e=>e.preventDefault(),children:(0,r.jsxs)("div",{className:"bg-[#2d333b] border border-[#444c56] rounded-2xl shadow-xl w-full max-w-lg sm:max-w-xl md:max-w-2xl",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 p-3 sm:p-4 border-b border-[#444c56]",children:[(0,r.jsx)("b",{className:"text-sm sm:text-base md:text-lg text-gray-200",children:"젬 추가"}),(0,r.jsx)("div",{className:"grow"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 px-3 sm:px-4 pt-2.5 sm:pt-3",children:[(0,r.jsx)("div",{className:"grow"}),(0,r.jsxs)("div",{className:"text-[11px] sm:text-xs md:text-sm text-gray-400",children:["형식:"," ",(0,r.jsx)("code",{className:"text-gray-300",children:"[계열] 의지력 포인트 [옵션1] [옵션2]"})]})]}),(0,r.jsx)("div",{className:"px-3 sm:px-4 pt-2.5 sm:pt-3",children:(0,r.jsx)("textarea",{className:"   w-full h-40 sm:h-44 md:h-52 bg-[#22272e] border border-[#444c56] rounded-md   px-2.5 sm:px-3 py-2 text-xs sm:text-sm text-gray-300   focus:outline-none focus:ring-0 focus:border-[#444c56]   placeholder:text-gray-400 placeholder:opacity-100   ",placeholder:"예)\n질서 6 4 보2 공1\n혼돈 5 3 낙2",value:s,onChange:e=>a(e.target.value)})}),(0,r.jsx)("div",{className:"px-3 sm:px-4 pb-2",children:d?(0,r.jsx)("div",{className:"border border-amber-500/40 bg-amber-500/10 rounded-xl p-2 text-amber-200 text-xs sm:text-sm",children:d}):(0,r.jsx)("div",{className:"border border-dashed border-[#444c56] rounded-xl p-2 text-center text-[11px] sm:text-sm text-gray-400",children:u.length?"인식된 젬 ".concat(u.length,"개"):"줄마다 ‘계열 의지력 포인트 옵션…’ 형식으로 입력하세요."})}),u.length>0&&(0,r.jsx)("div",{className:"px-3 sm:px-4 pb-2 space-y-1.5 sm:space-y-2 max-h-56 sm:max-h-64 overflow-auto",children:u.map((e,t)=>{let l=Math.max(1,e.base-e.effLv);return(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5 sm:gap-2 text-[12px] sm:text-sm text-gray-200",children:[(0,r.jsx)("span",{className:"px-1.5 sm:px-2 py-0.5 rounded-full border ".concat("order"===e.family?"bg-rose-900/40 text-rose-200 border-rose-800/60":"bg-blue-900/40 text-blue-200 border-blue-800/60"),children:"order"===e.family?"질서":"혼돈"}),(0,r.jsxs)("span",{className:"border border-[#444c56] rounded px-1.5 sm:px-2 py-0.5",children:["의지력 ",l]}),(0,r.jsxs)("span",{className:"border border-[#444c56] rounded px-1.5 sm:px-2 py-0.5",children:["포인트 ",e.pts]}),(0,r.jsxs)("span",{className:"text-[11px] sm:text-xs md:text-sm text-gray-400",children:["(기본 ",e.base,", 효율 Lv",e.effLv,")"]}),(0,r.jsx)("span",{className:"text-[11px] sm:text-xs md:text-sm text-gray-400",children:e.opts.length?e.opts.map(e=>"".concat(e.name," Lv").concat(e.lv)).join(" \xb7 "):"옵션 없음"})]},t)})}),(0,r.jsxs)("div",{className:"flex items-center gap-2 p-3 sm:p-4 border-t border-[#444c56]",children:[(0,r.jsx)("button",{className:"px-2.5 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-[#444c56] bg-[#2d333b] text-gray-200 hover:bg-[#30363d] transition text-xs sm:text-sm",onClick:t,children:"취소"}),(0,r.jsx)("div",{className:"grow"}),(0,r.jsx)("button",{className:"px-2.5 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-[#444c56] bg-[#2d333b] text-gray-200 hover:bg-[#30363d] transition text-xs sm:text-sm disabled:opacity-50",disabled:!u.length||!!d,onClick:()=>l(u),children:u.length?"젬 ".concat(u.length,"개 추가"):"추가할 항목 없음"})]})]})})}function A(e){let{className:t,wrapperClassName:l,left:n,right:s,...a}=e;return(0,r.jsxs)("div",{className:o("relative",l),children:[n&&(0,r.jsx)("span",{className:"absolute left-2 top-1/2 -translate-y-1/2 text-gray-400",children:n}),(0,r.jsx)("input",{...a,className:o("w-full bg-[#22272e] border border-[#444c56] rounded-md px-3 py-1.5 text-sm text-gray-300","outline-none focus:outline-none focus-visible:outline-none ring-0 focus:ring-0 focus-visible:ring-0 focus:border-[#444c56]","transition-all duration-150 placeholder:text-gray-500","[appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",n&&"pl-8",s&&"pr-8",t)}),s&&(0,r.jsx)("span",{className:"pointer-events-none absolute right-2 top-1/2 -translate-y-1/2 text-gray-400",children:s})]})}function B(e){let{title:t,family:l,list:s,params:a,onUpdate:o,onUpdateOption:i,onRemove:d,onQuickAddConfirm:c}=e,[u,m]=(0,n.useState)(!1);return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("div",{className:"font-bold",children:t}),(0,r.jsx)("button",{className:"px-3 py-1.5 rounded-lg border border-[#444c56] bg-[#2d333b] text-gray-200 hover:bg-[#30363d] transition",onClick:()=>m(!0),children:"젬추가"})]}),0===s.length&&(0,r.jsx)("div",{className:"border border-dashed border-[#444c56] rounded-lg p-3 text-center text-gray-400",children:"아직 젬이 없습니다"}),(0,r.jsx)("div",{className:"flex flex-col gap-3 mt-2",children:s.map(e=>(0,r.jsx)(I,{gem:e,family:l,params:a,onUpdate:o,onUpdateOption:i,onRemove:d},e.id))}),u&&(0,r.jsx)(U,{onClose:()=>m(!1),onConfirm:e=>{c(e),m(!1)}})]})}function I(e){var t,l,s,a,o,i,u,p,f,h,v,g;let{gem:y,family:j,params:N,onUpdate:C,onUpdateOption:M,onRemove:_}=e,[L,E]=(0,n.useState)(!1),O=S(y,N),R=P(y),D=null!=(s=null==(t=k(y,"의지력 효율"))?void 0:t.lv)?s:1,T=null!=(a=null==(l=k(y,"코어 포인트"))?void 0:l.lv)?a:1,U=y.options[2],B=y.options[3];return(0,r.jsxs)("div",{className:"border border-[#444c56] rounded-lg p-3 bg-[#2d333b]",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-2.5 h-2.5 rounded-full ".concat("order"===j?"bg-rose-500":"bg-blue-500")}),(0,r.jsxs)("div",{className:"font-semibold text-gray-200",children:[m[j]," 젬"]}),(0,r.jsxs)("span",{className:"text-xs text-gray-300 border border-[#444c56] rounded px-2 py-0.5",children:["의지력 ",O]}),(0,r.jsxs)("span",{className:"text-xs text-gray-300 border border-[#444c56] rounded px-2 py-0.5",children:["포인트 ",R]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[L?(0,r.jsx)("button",{className:"text-xs px-2 py-1 rounded border border-[#3a5e2a] bg-[#22301f] text-green-200 hover:bg-[#2a3c23] transition",onClick:()=>E(!1),title:"완료",children:"완료"}):(0,r.jsx)("button",{className:"text-xs px-2 py-1 rounded border border-[#444c56] bg-[#1f242c] text-gray-200 hover:bg-[#262c35] transition",onClick:()=>E(!0),title:"수정",children:"수정"}),(0,r.jsx)("button",{className:"text-xs px-2 py-1 rounded border border-[#8b2e2e] bg-[#3a2626] text-red-200 hover:bg-[#472b2b] transition",onClick:()=>_(j,y.id),children:"삭제"})]})]}),L?(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,r.jsx)(c,{label:"효율",children:(0,r.jsx)(d,{value:D,onChange:e=>M(j,y.id,0,{lv:Number(e)}),options:[1,2,3,4,5].map(e=>({value:e,label:"".concat(e,"Lv")}))})}),(0,r.jsx)(c,{label:"코어 포인트",children:(0,r.jsx)(d,{value:T,onChange:e=>M(j,y.id,1,{lv:Number(e)}),options:[1,2,3,4,5].map(e=>({value:e,label:"".concat(e,"Lv")}))})}),(0,r.jsx)(c,{label:"세부타입",children:(0,r.jsx)(d,{value:y.subType,onChange:e=>C(j,y.id,{subType:e,baseWill:w(String(e))}),options:x.map(e=>({value:e,label:e}))})}),(0,r.jsx)(c,{label:"기본 의지력",children:(0,r.jsx)(A,{type:"number",value:y.baseWill,onChange:e=>C(j,y.id,{baseWill:Number(e.target.value||0)})})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-2",children:[(0,r.jsx)(c,{label:"옵션1",children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(d,{className:"flex-1",value:null!=(f=null==U?void 0:U.name)?f:b[0],onChange:e=>M(j,y.id,2,{name:String(e)}),options:b.map(e=>({value:e,label:e}))}),(0,r.jsx)(d,{className:"w-28",value:null!=(h=null==U?void 0:U.lv)?h:1,onChange:e=>M(j,y.id,2,{lv:Number(e)}),options:[1,2,3,4,5].map(e=>({value:e,label:"Lv".concat(e)}))})]})}),(0,r.jsx)(c,{label:"옵션2",children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(d,{className:"flex-1",value:null!=(v=null==B?void 0:B.name)?v:b[0],onChange:e=>M(j,y.id,3,{name:String(e)}),options:b.map(e=>({value:e,label:e}))}),(0,r.jsx)(d,{className:"w-28",value:null!=(g=null==B?void 0:B.lv)?g:1,onChange:e=>M(j,y.id,3,{lv:Number(e)}),options:[1,2,3,4,5].map(e=>({value:e,label:"Lv".concat(e)}))})]})})]})]}):(0,r.jsx)("div",{className:"space-y-2",children:(0,r.jsx)("div",{className:"text-sm text-gray-200",children:(0,r.jsxs)("span",{className:"inline-flex items-center gap-2",children:[(0,r.jsxs)(F,{children:[null!=(o=null==U?void 0:U.name)?o:b[0]," \xb7 Lv",null!=(i=null==U?void 0:U.lv)?i:1]}),(0,r.jsxs)(F,{children:[null!=(u=null==B?void 0:B.name)?u:b[0]," \xb7 Lv",null!=(p=null==B?void 0:B.lv)?p:1]})]})})})]})}function F(e){let{children:t}=e;return(0,r.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded bg-black/20 border border-white/10 text-gray-200 text-xs",children:t})}function W(e){let{title:t,value:l}=e;return(0,r.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,r.jsx)("div",{className:"text-xs text-zinc-500",children:t}),(0,r.jsx)("div",{className:"font-semibold",children:l})]})}function z(e){let{plan:t,cores:l,gemById:n,orderPermIndex:s,onChangeOrderPerm:a}=e,o=l.filter(e=>e.enabled);return(0,r.jsxs)(r.Fragment,{children:["number"==typeof s&&a&&(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("div",{className:"text-[14px] text-gray-400",children:"최적 조합"}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsxs)("div",{className:"relative w-[320px] max-w-[80vw]",children:[(0,r.jsx)("select",{className:"w-full bg-[#22272e] border border-[#444c56] rounded-md px-3 pr-10 py-1.5 text-sm text-gray-300 appearance-none transition-all duration-150 focus:outline-none focus-visible:outline-none focus:ring-0 focus-visible:ring-0 focus:shadow-none focus:border-[#444c56]",value:s,onChange:e=>a(Number(e.target.value)),children:g.map((e,t)=>(0,r.jsx)("option",{value:t,children:e.map(e=>{var t;return null==(t=l.find(t=>t.key===e))?void 0:t.label}).filter(Boolean).join(" > ")},t))}),(0,r.jsx)(K,{})]})})]}),(0,r.jsx)("div",{className:"grid grid-cols-1 gap-3",children:o.map(e=>{var l,s,a,o,i,d,c,m,x,p,f;let h=t.answer[e.key],b=((null==h?void 0:h.ids)||[]).filter(Boolean);return(0,r.jsxs)("div",{className:"border border-[#444c56] rounded-lg p-3 bg-[#2d333b]",children:[(0,r.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"px-2.5 py-1 rounded-full text-xs font-medium whitespace-nowrap ".concat("order"===e.family?"bg-rose-900/50 text-rose-300 border border-rose-800/50":"bg-blue-900/50 text-blue-300 border border-blue-800/50"),children:e.label}),(0,r.jsxs)("span",{className:"text-[12px] text-gray-400",children:["의지력 ",u[e.grade]," \xb7 포인트 ",e.minPts,"~",e.maxPts]})]})}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2 mb-2",children:[b.length?b.map((e,t)=>{let l=n.get(e);if(!l)return null;let s=S(l,{efficiencyReductionByPoint:{1:1,2:2,3:3,4:4,5:5}}),a=P(l),o=function(e){var t,l;let r=null==(t=e.options)?void 0:t[2],n=null==(l=e.options)?void 0:l[3],s=e=>{var t,l;if(!(null==e?void 0:e.name))return null;let r=(e.name||"").trim(),n=Number(null!=(t=e.lv)?t:1)||1;return"".concat(null!=(l=v[r])?l:r).concat(n)};return[s(r),s(n)].filter(Boolean).join(" ")}(l);return(0,r.jsxs)("span",{className:"inline-flex items-center rounded-full px-2.5 py-1 text-xs border border-[#444c56] bg-[#22272e] text-gray-300",children:["(".concat(s,",").concat(a,")"),o&&(0,r.jsx)("span",{className:"mx-1 opacity-60",children:"\xb7"}),o,(0,r.jsxs)("small",{className:"ml-1 opacity-60",children:["#",t+1]})]},e)}):(0,r.jsx)("span",{className:"text-sm text-gray-400",children:"선정된 젬 없음"}),(null==h?void 0:h.reason)&&(0,r.jsx)("span",{className:"inline-flex items-center rounded-full px-2.5 py-1 text-xs border border-amber-500/50 bg-amber-900/20 text-amber-300",children:h.reason})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2",children:[(0,r.jsx)(W,{title:"코어 포인트 합",value:null!=(c=null==h||null==(l=h.res)?void 0:l.pts)?c:"-"}),(0,r.jsx)(W,{title:"의지력 잔여",value:(null==h?void 0:h.res)?h.res.remain:"-"}),(0,r.jsx)(W,{title:"활성 슬롯",value:null!=(m=null==h||null==(a=h.res)||null==(s=a.activated)?void 0:s.filter(Boolean).length)?m:"-"}),(0,r.jsx)(W,{title:"스탯 점수",value:(null==h?void 0:h.res)?Number(h.res.flexScore).toFixed(2):"-"})]}),(null==h?void 0:h.res)&&(0,r.jsxs)("div",{className:"text-[12px] text-gray-400 mt-2",children:["보스:",null!=(x=null==(o=h.res.flex)?void 0:o["보스 피해"])?x:0," / 추가:",null!=(p=null==(i=h.res.flex)?void 0:i["추가 피해"])?p:0," / 공:",null!=(f=null==(d=h.res.flex)?void 0:d["공격력"])?f:0]})]},e.key)})})]})}function K(){return(0,r.jsx)("span",{className:"pointer-events-none absolute right-2.5 top-1/2 -translate-y-1/2 text-gray-400",children:(0,r.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M5.23 7.21a.75.75 0 0 1 1.06.02L10 10.94l3.71-3.71a.75.75 0 1 1 1.06 1.06l-4.24 4.24a.75.75 0 0 1-1.06 0L5.21 8.29a.75.75 0 0 1 .02-1.08z",clipRule:"evenodd"})})})}function J(e){let{coreCount:t,invCount:l,onRun:n}=e;return(0,r.jsxs)("footer",{className:"bottom-0 left-0 right-0 bg-[#2d333b] backdrop-blur border border-[#444c56] rounded-lg px-4 py-3 flex items-center gap-3",children:[(0,r.jsxs)("div",{className:"text-sm ",children:["선택 코어 ",(0,r.jsx)("b",{className:"ml-1 ",children:t})]}),(0,r.jsxs)("div",{className:"text-sm ",children:["보유 젬 ",(0,r.jsx)("b",{className:"ml-1 ",children:l})]}),(0,r.jsx)("div",{className:"grow"}),(0,r.jsx)("button",{className:"px-4 py-2 rounded-xl bg-blue-600 text-white font-semibold",onClick:n,children:"최적화"})]})}function q(){var e;let[t,l]=(0,n.useState)(a),[o,c]=(0,n.useState)(!1),[u,m]=(0,n.useState)(null),[x]=(0,n.useState)("default"),[p,f]=(0,n.useState)(0),[h,b]=(0,n.useState)(!1),v=(0,n.useRef)(null),[g,y]=(0,n.useState)(null),[j,N]=(0,n.useState)(null),[w,k]=(0,n.useState)(!0),S=(0,n.useMemo)(()=>t.cores.filter(e=>e.enabled),[t.cores]),[P,C]=(0,n.useState)(!1),[M,_]=(0,n.useState)({v:null,msg:""});(0,n.useRef)(!1);let[E,O]=(0,n.useState)(()=>{let e=new Date;return"arcgrid_".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"),"-").concat(String(e.getDate()).padStart(2,"0"))}),[D,T]=(0,n.useState)(new Set);async function A(){var e,l,r,n,s,a;let o=t.cores.filter(e=>e.enabled);if(!o.length)return V("선택된 코어가 없어요");if(0===G)return V("인벤토리에 젬을 추가해 주세요");let i=Object.fromEntries(t.cores.map(e=>[e.key,{minPts:e.minPts,maxPts:e.maxPts}])),d=null!=(l=t.params.role)?l:"dealer";F("최대 포인트 계산 준비...",5),await q(),W("최대 포인트 계산 중...",30);let c=(n=o,s=t.params,a=t.inventory,Object.values(L(n,s,a,i).answer).reduce((e,t)=>{var l,r;return e+(null!=(r=null==t||null==(l=t.res)?void 0:l.pts)?r:0)},0));await q(),W("스탯 상위 조합 탐색 중...",75);let u=R(o,t.params,t.inventory,i,d,3,c,2e3);N(u),0===u.length?V("조건을 만족하는 조합이 없어요"):V("최대 총포인트 ".concat(null!=(r=null==(e=u[0])?void 0:e.sumPts)?r:0,"에서 스탯 상위 ").concat(u.length,"개")),W("결과 정리 중...",90),await q(),K()}async function I(){var e,l,r;let n=t.cores.filter(e=>e.enabled);if(!n.length)return V("선택된 코어가 없어요");if(0===G)return V("인벤토리에 젬을 추가해 주세요");let s=Object.fromEntries(t.cores.map(e=>[e.key,{minPts:e.minPts,maxPts:e.maxPts}])),a=null!=(e=t.params.role)?e:"dealer";F("supporter"===a?"서포터 기준 스탯(지원 옵션) 우선 조합 계산 중...":"딜러 기준 스탯(딜 옵션) 우선 조합 계산 중...",10),await q();let o=R(n,t.params,t.inventory,s,a,3,null,2e3);W("결과 정리 중...",85),await q(),o.length?(N(o),m({plan:o[0].plan,focusKey:null!=(r=null==(l=n[0])?void 0:l.key)?r:null}),V("".concat("supporter"===a?"서포터":"딜러"," 기준 스탯 우선 상위 ").concat(o.length,"개"))):(N(null),V("조건을 만족하는 조합이 없어요")),K()}(0,n.useEffect)(()=>{T(new Set)},[j]);let F=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;_({v:t,msg:e}),C(!0)},W=(e,t)=>_({v:t,msg:e}),K=()=>{_({v:100,msg:"완료"}),setTimeout(()=>C(!1),300)},q=()=>new Promise(e=>setTimeout(e,0));(0,n.useEffect)(()=>{l(function(){let e=a();try{var t,l;let r=localStorage.getItem(s);if(!r)return e;let n=JSON.parse(r),a=new Map(e.cores.map(e=>[e.key,e])),o=e.cores.map(e=>{let t=(n.cores||[]).find(t=>t.key===e.key);return t?{...e,...t}:e});for(let e of n.cores||[])a.has(e.key)||o.push(e);return{...e,params:{...e.params,...n.params||{}},cores:o,inventory:{order:(null==(t=n.inventory)?void 0:t.order)||e.inventory.order,chaos:(null==(l=n.inventory)?void 0:l.chaos)||e.inventory.chaos}}}catch(t){return console.warn("[arcgrid] loadState failed:",t),e}}()),c(!0)},[]),(0,n.useEffect)(()=>{if(!o)return;let e=setTimeout(()=>(function(e){try{var t,l;let r=JSON.stringify({params:null==e?void 0:e.params,cores:((null==e?void 0:e.cores)||[]).map(e=>({family:e.family,key:e.key,label:e.label,grade:e.grade,enabled:!!e.enabled,minPts:Number(e.minPts||0),maxPts:Number(e.maxPts||0)})),inventory:{order:(null==e||null==(t=e.inventory)?void 0:t.order)||[],chaos:(null==e||null==(l=e.inventory)?void 0:l.chaos)||[]}});localStorage.setItem(s,r)}catch(e){console.warn("[arcgrid] saveState failed:",e)}})(t),100);return()=>clearTimeout(e)},[t,o]);let G=t.inventory.order.length+t.inventory.chaos.length,H=t.cores.filter(e=>e.enabled).length,V=e=>{y(e),setTimeout(()=>y(null),1400)};function Y(e,t,r){l(l=>({...l,inventory:{...l.inventory,[e]:l.inventory[e].map(e=>e.id===t?{...e,...r}:e)}}))}function Z(e,t,r,n){l(l=>({...l,inventory:{...l.inventory,[e]:l.inventory[e].map(e=>{if(e.id!==t)return e;let l=e.options.slice(),s={...l[r],...n};return Object.prototype.hasOwnProperty.call(n,"name")&&null==s.lv&&(s.lv=1),null!=s.lv&&(s.lv=Number(s.lv)||1),l[r]=s,{...e,options:l}})}}))}function $(e,t){l(l=>({...l,inventory:{...l.inventory,[e]:l.inventory[e].filter(e=>e.id!==t)}}))}async function X(){let e=t.cores.filter(e=>e.enabled);if(!e.length)return V("선택된 코어가 없어요");if(0===G)return V("인벤토리에 젬을 추가해 주세요");let l=Object.fromEntries(t.cores.map(e=>[e.key,{minPts:e.minPts,maxPts:e.maxPts}]));F("최대 포인트 플랜 계산 중...",25),await q();let r=L(e,t.params,t.inventory,l);W("결과 적용...",85),await q(),m({plan:r,focusKey:e[0].key}),V("최적 조합을 계산했어요"),K()}let ee=(0,n.useMemo)(()=>{let e=new Map;for(let l of t.inventory.order)e.set(l.id,l);for(let l of t.inventory.chaos)e.set(l.id,l);return e},[t.inventory]);return(0,r.jsxs)("div",{className:"space-y-6 sm:space-y-8 py-4 sm:py-6 md:py-8 text-xs sm:text-sm md:text-base text-gray-300 w-full",children:[(0,r.jsx)(i,{title:"젬 세팅 저장",children:(0,r.jsxs)("div",{className:"w-full flex flex-col sm:flex-row sm:items-center justify-between gap-3 sm:gap-4",children:[(0,r.jsxs)("div",{className:"text-[12px] sm:text-sm text-gray-400 whitespace-nowrap",children:["선택 코어\xa0",(0,r.jsx)("b",{className:"text-gray-200",children:H}),"\xa0\xa0\xa0\xa0보유 젬\xa0",(0,r.jsx)("b",{className:"text-gray-200",children:G})]}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-2 sm:gap-2.5",children:[(0,r.jsx)("input",{className:" px-2.5 sm:px-3 py-2 rounded-lg border border-[#444c56] bg-[#2d333b] text-gray-200 w-[180px] sm:w-56 focus:outline-none focus:ring-0 focus-visible:ring-0 focus:border-[#444c56] focus:shadow-none ",onChange:e=>O(e.target.value),placeholder:"파일 이름"}),(0,r.jsx)("button",{className:"px-3 sm:px-3.5 py-2 rounded-lg border border-[#444c56] bg-[#2d333b] text-gray-200 hover:bg-[#30363d] transition",onClick:function(){let e=new Blob([JSON.stringify({version:1,params:t.params,cores:t.cores.map(e=>({key:e.key,enabled:!!e.enabled,grade:e.grade,minPts:Number(e.minPts||0),maxPts:Number(e.maxPts||0),family:e.family,label:e.label})),inventory:t.inventory},null,2)],{type:"application/json"}),l=(E||"arcgrid_setup").replace(/[\\/:*?"<>|]/g,"").trim();l||(l="arcgrid_setup"),l.toLowerCase().endsWith(".json")||(l+=".json");let r=document.createElement("a");r.href=URL.createObjectURL(e),r.download=l,r.click(),URL.revokeObjectURL(r.href),V("파일로 저장했어요")},children:"젬 세팅 저장"}),(0,r.jsxs)("label",{className:"relative px-3 sm:px-3.5 py-2 rounded-lg border border-[#444c56] bg-[#2d333b] text-gray-200 hover:bg-[#30363d] transition cursor-pointer",children:["젬 세팅 불러오기",(0,r.jsx)("input",{ref:v,type:"file",accept:"application/json",className:"absolute opacity-0 w-0 h-0 pointer-events-none",onChange:function(e){var t;let r=null==(t=e.target.files)?void 0:t[0];if(!r)return;let n=new FileReader;n.onload=()=>{try{let e=JSON.parse(String(n.result))||{};l(t=>{let l=t.cores.map(t=>{var l,r,n,s,a,o;let i=null==(l=e.cores)?void 0:l.find(e=>(null==e?void 0:e.key)===t.key);return i?{...t,enabled:"boolean"==typeof i.enabled?i.enabled:t.enabled,grade:null!=(r=i.grade)?r:t.grade,minPts:Number(null!=(s=null!=(n=i.minPts)?n:t.minPts)?s:0),maxPts:Number(null!=(o=null!=(a=i.maxPts)?a:t.maxPts)?o:0)}:t}),r={...t.params,...e.params||{}},n=e=>{var t,l;return{...e,id:(null==e?void 0:e.id)||(null==(l=crypto)||null==(t=l.randomUUID)?void 0:t.call(l))||Math.random().toString(36).slice(2)}},s=e.inventory?{order:Array.isArray(e.inventory.order)?e.inventory.order.map(n):t.inventory.order,chaos:Array.isArray(e.inventory.chaos)?e.inventory.chaos.map(n):t.inventory.chaos}:t.inventory;return{...t,cores:l,params:r,inventory:s}}),V("파일에서 불러왔어요")}catch(e){V("불러오기에 실패했습니다")}},n.readAsText(r)}})]}),(0,r.jsx)("button",{className:"px-3 sm:px-3.5 py-2 rounded-lg border border-[#8b2e2e] bg-[#3a2626] text-red-200 hover:bg-[#472b2b] transition",onClick:function(){l(()=>a())},title:"인벤토리를 비웁니다",children:"젬 비우기"})]})]})}),(0,r.jsx)(i,{title:"1. 코어 선택",children:(0,r.jsxs)("div",{className:"w-full space-y-4",children:[(0,r.jsx)("div",{className:"inline-grid grid-cols-[auto_auto] gap-x-4 sm:gap-x-5 items-center w-fit",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("label",{className:"text-[12px] sm:text-sm text-gray-400 mr-2",children:"역할"}),(0,r.jsx)("div",{className:"w-36 sm:w-40",children:(0,r.jsx)(d,{value:null!=(e=t.params.role)?e:"dealer",onChange:e=>l(t=>({...t,params:{...t.params,role:e}})),options:[{value:"dealer",label:"딜러"},{value:"supporter",label:"서포터"}],placeholder:"역할 선택"})})]})}),(0,r.jsxs)("div",{className:"grid [grid-template-columns:1.1fr_.9fr_.8fr_.8fr] gap-2 items-center mt-1 text-[12px] sm:text-sm",children:[(0,r.jsx)("div",{className:"text-gray-400",children:"코어"}),(0,r.jsx)("div",{className:"text-gray-400",children:"등급"}),(0,r.jsx)("div",{className:"text-gray-400",children:"최소 포인트"}),(0,r.jsx)("div",{className:"text-gray-400",children:"최대 포인트"}),t.cores.map((e,t)=>(0,r.jsx)(Q,{core:e,onToggle:r=>l(l=>{let n=l.cores.slice();return n[t]={...e,enabled:r},{...l,cores:n}}),onGrade:r=>l(l=>{let n=l.cores.slice();return n[t]={...e,grade:r},{...l,cores:n}}),onMin:r=>l(l=>{let n=l.cores.slice();return n[t]={...e,minPts:Number(r||0)},{...l,cores:n}}),onMax:r=>l(l=>{let n=l.cores.slice();return n[t]={...e,maxPts:Number(r||0)},{...l,cores:n}})},e.key))]})]})}),(0,r.jsx)(i,{title:"2. 보유 젬 입력",children:(0,r.jsx)("div",{className:"w-full",children:(0,r.jsxs)("div",{className:"grid md:grid-cols-2 gap-4 sm:gap-6 mt-3",children:[(0,r.jsx)(B,{title:"질서 인벤토리",family:"order",list:t.inventory.order,params:t.params,onUpdate:Y,onUpdateOption:Z,onRemove:$,onQuickAddConfirm:e=>{l(t=>{let l={...t,inventory:{...t.inventory}};for(let t of e){var r,n;let e={id:(null==(n=crypto)||null==(r=n.randomUUID)?void 0:r.call(n))||Math.random().toString(36).slice(2),family:t.family,subType:t.subType,baseWill:t.base,options:[{name:"의지력 효율",lv:t.effLv,fixed:!0},{name:"코어 포인트",lv:t.pts,fixed:!0},...t.opts.slice(0,2).map(e=>({name:e.name,lv:e.lv}))]};l.inventory[e.family]=[...l.inventory[e.family],e]}return l}),V("젬 ".concat(e.length,"개 추가"))}}),(0,r.jsx)(B,{title:"혼돈 인벤토리",family:"chaos",list:t.inventory.chaos,params:t.params,onUpdate:Y,onUpdateOption:Z,onRemove:$,onQuickAddConfirm:e=>{l(t=>{let l={...t,inventory:{...t.inventory}};for(let t of e){var r,n;let e={id:(null==(n=crypto)||null==(r=n.randomUUID)?void 0:r.call(n))||Math.random().toString(36).slice(2),family:t.family,subType:t.subType,baseWill:t.base,options:[{name:"의지력 효율",lv:t.effLv,fixed:!0},{name:"코어 포인트",lv:t.pts,fixed:!0},...t.opts.slice(0,2).map(e=>({name:e.name,lv:e.lv}))]};l.inventory[e.family]=[...l.inventory[e.family],e]}return l}),V("젬 ".concat(e.length,"개 추가"))}})]})})}),(0,r.jsx)(i,{title:"3. 결과 확인",children:(0,r.jsxs)("div",{className:"w-full",children:[(0,r.jsxs)("div",{className:"flex flex-wrap justify-start gap-1.5 sm:gap-2 mb-2 text-[10px] sm:text-xs",children:[(0,r.jsx)("button",{className:"px-2.5 py-1.5 rounded-md bg-[#2d333b] border border-[#444c56] text-gray-200 hover:bg-[#30363d] transition",onClick:X,children:"포인트 우선 최적화"}),(0,r.jsx)("button",{className:"px-2.5 py-1.5 rounded-md bg-[#2d333b] border border-[#444c56] text-gray-200 hover:bg-[#30363d] transition",onClick:A,children:"최대 포인트 내 스탯 Top"}),(0,r.jsx)("button",{className:"px-2.5 py-1.5 rounded-md bg-[#2d333b] border border-[#444c56] text-gray-200 hover:bg-[#30363d] transition",onClick:I,children:"supporter"===t.params.role?"서포터 스탯(지원) 우선":"딜러 스탯(딜) 우선"})]}),u?(0,r.jsx)("div",{className:"rounded-lg bg-[#2d333b]",children:(0,r.jsx)(z,{plan:u.plan,cores:t.cores,gemById:ee,..."extreme"===x?{orderPermIndex:p,onChangeOrderPerm:e=>f(e)}:{}})}):(0,r.jsxs)("div",{className:"border border-dashed border-[#444c56] rounded-lg p-3 sm:p-4 text-center text-gray-400 text-[12px] sm:text-sm",children:["아래 오른쪽의 ",(0,r.jsx)("b",{className:"text-gray-200",children:"최적화"})," 버튼을 눌러 조합을 계산해 보세요."]}),j&&j.length>0&&(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-1.5",children:[(0,r.jsxs)("div",{className:"text-[10px] sm:text-xs text-gray-400",children:["상위 ",j.length,"개 조합 (스탯 점수 기준)"]}),(0,r.jsx)("button",{className:"px-2 py-0.5 rounded-md text-[10px] sm:text-xs bg-transparent text-gray-400 hover:text-gray-200 hover:bg-[#22272e] transition",onClick:()=>k(e=>!e),children:w?"Top 목록 접기 ▴":"Top 목록 펼치기 ▾"})]}),w&&(0,r.jsx)("div",{className:"overflow-x-auto rounded-lg border border-[#444c56]",children:(0,r.jsxs)("table",{className:"w-full text-[11px] sm:text-xs md:text-sm text-center",children:[(0,r.jsx)("thead",{className:"bg-[#22272e] text-gray-300",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-2 sm:px-3 py-2 w-8 sm:w-10"}),(0,r.jsx)("th",{className:"px-2 sm:px-3 py-2 text-center w-10 sm:w-14",children:"#"}),(0,r.jsx)("th",{className:"px-2 sm:px-3 py-2 text-center w-28 sm:w-32",children:"스탯 점수"}),(0,r.jsx)("th",{className:"px-2 sm:px-3 py-2 text-center w-24 sm:w-28",children:"총 포인트"}),(0,r.jsx)("th",{className:"px-2 sm:px-3 py-2 text-center w-28 sm:w-32",children:"잔여 의지력"}),S.map(e=>(0,r.jsx)("th",{className:"px-2 sm:px-3 py-2 text-center whitespace-nowrap",children:e.label},e.key)),(0,r.jsx)("th",{className:"px-2 sm:px-3 py-2 text-center w-20 sm:w-24"})]})}),(0,r.jsx)("tbody",{className:"divide-y divide-[#444c56]",children:j.map((e,l)=>{let s=6+S.length,a=D.has(l);return(0,r.jsxs)(n.Fragment,{children:[(0,r.jsxs)("tr",{className:"bg-[#2d333b] hover:bg-[#30363d]",children:[(0,r.jsx)("td",{className:"px-2 sm:px-3 py-2",children:(0,r.jsx)("button",{"aria-label":a?"접기":"펼치기",className:"w-6 h-6 rounded hover:bg-black/20",onClick:()=>{T(e=>{let t=new Set(e);return t.has(l)?t.delete(l):t.add(l),t})},children:(0,r.jsx)("span",{className:"inline-block align-middle",children:a?"▾":"▸"})})}),(0,r.jsxs)("td",{className:"px-2 sm:px-3 py-2 text-gray-300 text-center",children:["#",l+1]}),(0,r.jsx)("td",{className:"px-2 sm:px-3 py-2 text-center",children:(0,r.jsx)("b",{className:"text-white",children:e.statScore.toFixed(3)})}),(0,r.jsx)("td",{className:"px-2 sm:px-3 py-2 text-center",children:(0,r.jsx)("b",{className:"text-gray-200",children:e.sumPts})}),(0,r.jsx)("td",{className:"px-2 sm:px-3 py-2 text-center",children:(0,r.jsx)("b",{className:"text-gray-200",children:e.sumRemain})}),S.map(t=>{var l,n,s;let a=e.plan.answer[t.key],o=null!=(s=null==a||null==(l=a.res)?void 0:l.pts)?s:0,i="number"==typeof(null==a||null==(n=a.res)?void 0:n.flexScore)?a.res.flexScore:0;return(0,r.jsx)("td",{className:"px-2 sm:px-3 py-2 text-gray-300 text-center",children:(0,r.jsxs)("div",{className:"flex items-center justify-center gap-1.5 sm:gap-2",children:[(0,r.jsxs)("span",{className:"px-1.5 sm:px-2 py-0.5 rounded bg-black/20 border border-white/10",children:[o,"p"]}),(0,r.jsx)("span",{className:"text-gray-400",children:"\xb7"}),(0,r.jsx)("span",{className:"tabular-nums",children:i.toFixed(3)})]})},t.key)}),(0,r.jsx)("td",{className:"px-2 sm:px-3 py-2 text-center",children:(0,r.jsx)("button",{className:"px-2.5 sm:px-3 py-1.5 rounded-md border border-[#444c56] bg-[#1f242c] text-gray-200 hover:bg-[#262c35] transition",onClick:()=>{var t;m({plan:e.plan,focusKey:null==(t=S[0])?void 0:t.key}),y("#".concat(l+1," 조합을 적용했어요")),setTimeout(()=>y(null),1400)},children:"적용"})})]}),a&&(0,r.jsx)("tr",{className:"bg-[#1f242c]",children:(0,r.jsx)("td",{colSpan:s,className:"px-2 sm:px-3 py-3",children:(0,r.jsx)("div",{className:"rounded-lg border border-[#444c56] bg-[#2d333b]",children:(0,r.jsx)(z,{plan:e.plan,cores:t.cores,gemById:ee})})})})]},"plan-".concat(l))})})]})})]})]})}),(0,r.jsx)(J,{coreCount:H,invCount:G,onRun:X}),g&&(0,r.jsx)("div",{className:"fixed bottom-24 sm:bottom-24 right-4 sm:right-5 px-3 py-2 rounded-xl bg-zinc-900 text-white text-[12px] sm:text-sm shadow opacity-95",children:g}),h&&(0,r.jsx)(U,{onClose:()=>b(!1),onConfirm:e=>{l(t=>{let l={...t,inventory:{...t.inventory}};for(let t of e){var r,n;let e={id:(null==(n=crypto)||null==(r=n.randomUUID)?void 0:r.call(n))||Math.random().toString(36).slice(2),family:t.family,subType:t.subType,baseWill:t.base,options:[{name:"의지력 효율",lv:t.effLv,fixed:!0},{name:"코어 포인트",lv:t.pts,fixed:!0},...t.opts.slice(0,2).map(e=>({name:e.name,lv:e.lv}))]};l.inventory[e.family]=[...l.inventory[e.family],e]}return l}),b(!1),V("젬 ".concat(e.length,"개 추가"))}}),P&&(0,r.jsxs)("div",{className:"fixed inset-0 z-[100] pointer-events-none",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm pointer-events-none"}),(0,r.jsx)("div",{className:"absolute bottom-4 sm:bottom-6 left-1/2 -translate-x-1/2 w-[min(520px,92vw)] pointer-events-auto",children:(0,r.jsxs)("div",{className:"rounded-xl border border-[#444c56] bg-[#1f242c] shadow-lg overflow-hidden",children:[(0,r.jsx)("div",{className:"px-3 sm:px-4 pt-2.5 sm:pt-3 pb-2 text-[12px] sm:text-sm md:text-base text-gray-200",children:M.msg||"작업을 준비하고 있어요"}),(0,r.jsx)("div",{className:"h-2 bg-black/30",children:null==M.v?(0,r.jsx)("div",{className:"h-2 w-1/3 bg-blue-600/70 animate-pulse"}):(0,r.jsx)("div",{className:"h-2 bg-blue-600 transition-[width] duration-200 ease-out",style:{width:"".concat(Math.max(0,Math.min(100,M.v)),"%")},"aria-valuenow":M.v,"aria-valuemin":0,"aria-valuemax":100,role:"progressbar"})})]})})]})]})}function Q(e){let{core:t,onToggle:l,onGrade:s,onMin:a,onMax:o}=e,i=function(e){let[t,l]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{let t=window.matchMedia(e),r=e=>l(("matches"in e,e.matches));return r(t),t.addEventListener?t.addEventListener("change",r):t.addListener(r),()=>{t.removeEventListener?t.removeEventListener("change",r):t.removeListener(r)}},[e]),t}("(max-width: 640px)"),c=(0,n.useMemo)(()=>{let e=!i;return[{value:"heroic",label:e?"영웅(9)":"영웅"},{value:"legend",label:e?"전설(12)":"전설"},{value:"relic",label:e?"유물(15)":"유물"},{value:"ancient",label:e?"고대(17)":"고대"}]},[i]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2.5 sm:gap-3 py-1.5",children:[(0,r.jsxs)("label",{className:"inline-flex items-center cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:t.enabled,onChange:e=>l(e.target.checked)}),(0,r.jsx)("div",{className:" relative /* 트랙 크기: base(모바일) → sm → md */ w-9   h-5 sm:w-11 sm:h-6 md:w-[52px] md:h-7 bg-gray-600 rounded-full peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500 peer-checked:bg-blue-600 /* 손잡이 공통 */ after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border after:border-gray-300 after:rounded-full after:transition-all /* 손잡이 크기: base → sm → md */ after:h-4  after:w-4 sm:after:h-5 sm:after:w-5 md:after:h-6 md:after:w-6 /* 이동 */ peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full "})]}),(0,r.jsx)("span",{className:"px-2 sm:px-2.5 py-0.5 sm:py-1 rounded-full text-[11px] sm:text-xs md:text-sm font-medium whitespace-nowrap ".concat("order"===t.family?"bg-rose-900/50 text-rose-300 border border-rose-800/50":"bg-blue-900/50 text-blue-300 border border-blue-800/50"),children:t.label})]}),(0,r.jsx)("div",{className:"text-[12px] sm:text-sm",children:(0,r.jsx)(d,{value:t.grade,onChange:e=>s(e),options:c})}),(0,r.jsx)("div",{className:"text-[12px] sm:text-sm",children:(0,r.jsx)(A,{type:"number",value:t.minPts,onChange:e=>a(Number(e.target.value||0))})}),(0,r.jsx)("div",{className:"text[12px] sm:text-sm",children:(0,r.jsx)(A,{type:"number",value:t.maxPts,onChange:e=>o(Number(e.target.value||0))})})]})}}},e=>{e.O(0,[441,255,358],()=>e(e.s=1220)),_N_E=e.O()}]);